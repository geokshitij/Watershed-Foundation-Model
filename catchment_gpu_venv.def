Bootstrap: docker
From: python:3.13-slim

%labels
    Author Minimal
    Version 1.1

%environment
    export LC_ALL=C.UTF-8
    export LANG=C.UTF-8
    export PATH=/usr/local/bin:$PATH
    # avoid pip warning spam (optional)
    export PIP_ROOT_USER_ACTION=ignore

%post
    set -euo pipefail

    python -m pip install --upgrade pip setuptools wheel

    python -m pip install --no-cache-dir --prefer-binary \
        "imagecodecs==2025.8.2" \
        "lightly==1.5.22" \
        "lightly-utils==0.0.2" \
        "numpy==2.3.3" \
        "pytorch-lightning==2.5.5" \
        "tifffile==2025.10.16" \
        "timm==1.0.20" \
        "torch==2.9.0" \
        "torchmetrics==1.8.2" \
        "torchvision==0.24.0" \
        "flask==3.1.2"

    # Safe, minimal cleanup: clear pip cache and apt lists only.
    python -m pip cache purge || true
    rm -rf /var/lib/apt/lists/* || true
    # optionally remove pip caches in common locations
    rm -rf /root/.cache/pip || true
    rm -rf /root/.cache/pip/http || true

%runscript
    exec /bin/bash -lc 'python -c "import sys; print(f\"Python {sys.version}\")" && exec /bin/bash'
